<div class="flex items-center justify-center gap-4 mb-8">
  <%= link_to [@track.user] do %>
    <%= avatar(user: @track.user, size: "size-6") %>
  <% end %>

  <div class="font-mono text-xl">
    <span class="text-neutral-400">#<span><span class="text-black"><%= @track.number %></span>
  </div>
</div>

<div class="mb-24">
  <% @recordings.each do |recording| %>
    <div id="<%= recording.id %>" class="flex items-center justify-center mb-4">
      <div>
        <div class="flex items-start gap-4 mb-2">
          <div class="flex flex-col items-center" data-controller="waveform" data-waveform-url-value="<%= url_for(recording.file) %>">
            <%= link_to [recording.user] do %>
              <%= avatar(user: recording.user, size: "size-16") %>
            <% end %>

            <div class="my-2 font-mono font-semibold text-sm text-neutral-500">
              <%= recording.created_at.strftime("%Y-%m-%d %H:%M") %>
            </div>

            <div class="my-2 font-mono font-semibold text-sm text-neutral-400">
              <%= format_duration(recording.duration) %>
            </div>

            <div data-waveform-target="container" class="flex h-120 [&>wave]:!cursor-pointer"></div>

            <audio controls class="hidden" data-waveform-target="audio">
              <%= tag.source src: url_for(recording.file), type: recording.file.content_type %>
            </audio>

            <% if recording.user == Current.user %>
              <%= button_to recording_path(recording), method: :delete,
                  data: { turbo_confirm: "???" },
                  class: "cursor-pointer" do %>
                <%= icon("x-circle", size: "size-10") %>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>

<% if user_logged_in? %>
  <%= form_for [@recording.track, @recording], data: { turbo: false, controller: "audio-recorder" } do |f| %>
    <%= f.hidden_field :duration, data: { audio_recorder_target: "durationInput" } %>
    <%= f.file_field :file, hidden: true, direct_upload: true, accept: "audio/webm", data: { audio_recorder_target: "fileInput" } %>

    <div class="flex flex-col items-center">
      <%= link_to [@recording.user] do %>
        <%= avatar(user: @recording.user, size: "size-16") %>
      <% end %>

      <div class="my-2 font-mono font-semibold text-sm text-neutral-500">
        <%= Time.current.strftime("%Y-%m-%d %H:%M") %>
      </div>

      <div class="my-2 font-mono font-semibold text-sm text-neutral-400" data-audio-recorder-target="duration">
        <%= format_duration(@recording.duration) %>
      </div>

      <div class="flex justify-center gap-4">
        <%= content_tag :button, type: :button, data: { audio_recorder_target: "toggleButton", action: "audio-recorder#toggleRecording" }, class: "cursor-pointer text-red-600" do %>
          <span data-audio-recorder-target="recordIcon">
            <%= icon("record-circle", size: "size-20") %>
          </span>
          <span data-audio-recorder-target="stopIcon" class="hidden">
            <%= icon("stop-circle", size: "size-20") %>
          </span>
        <% end %>
      </div>
    </div>
  <% end %>
<% end %>
